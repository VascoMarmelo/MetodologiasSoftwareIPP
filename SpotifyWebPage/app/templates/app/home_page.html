{% extends 'app/base_page.html' %}

<!--Corpo do perfil-->
{% block content %}

    <div class="container" ng-controller="myCtrlHomeApp">
        <button class="btn btn-primary" ng-click="loginCallBack()">BTN </button>
        
    
    
    
    </div>      

    <script>
        app.controller('myCtrlHomeApp', function($scope, $interval, $http){
            //Javascript

            //Token de autenticacao do spotify
            $scope.token = '';     
            $scope.client_id = '82317a0473474f8d944323a93d488939';
            $scope.client_secret = 'b4ab4620abcc42dca2195bde4a982607';
            
            $scope.initService = function(){

                
                $http({
                    method: 'POST',
                    url: 'https://accounts.spotify.com/api/token',
                    headers: {
                        'Content-type': 'application/x-www-form-urlencoded',
                    },
                    data: 'grant_type=client_credentials&client_id=' + $scope.client_id + '&client_secret=' + $scope.client_secret,
                }).then(function successCallback(response) {
                    // Gere resposta, em caso de sucesso
                    let apiData = response.data; // Access the response data here
                    $scope.token = apiData.access_token;
                }, function errorCallback(error) {
                    // Gere resposta, em caso de falha
                    console.error('Error fetching data:', error);
                });
                
            }

            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            $scope.initService();
            /*
            $scope.loginCallBack = function(){
                $http({
                    method: 'GET',
                    url: 'https://api.spotify.com/v1/me',
                    headers: {
                        'Authorization' : 'Bearer ' + $scope.token
                    }
                }).then(function successCallback(response) {
                    // Gere resposta, em caso de sucesso
                    $scope.apiData = response.data; // Access the response data here
                    console.log($scope.apiData);
                    console.log($scope.apiData.text);
                }, function errorCallback(error) {
                    // Gere resposta, em caso de falha
                    console.error('Error fetching data:', error);
                });
            };
            */

            //https://www.youtube.com/watch?v=1vR3m0HupGI
            $scope.loginCallBack = function(){

                $http({
                    method: 'GET',
                    url: 'https://accounts.spotify.com/authorize',
                    headers: {
                        'Access-Control-Allow-Origin': '*',
                    },
                    params: "client_id=" + $scope.client_id + "&response_type=code&redirect_uri=http://127.0.0.1:8000/perfil&show_dialog=true" +
                    "&scope=ugc-image-upload playlist-read-private"   
                }).then(function successCallback(response) {
                    // Gere resposta, em caso de sucesso
                    $scope.apiData = response.data; // Access the response data here
                }, function errorCallback(error) {
                    console.error('Error fetching data:', error);
                });
            }

        });
    </script>

{% endblock %}